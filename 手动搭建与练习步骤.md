## 目标说明

- **目标**: 手动从零搭建当前这个「运营反馈数据管理页」前端项目，并自己敲一遍核心代码。
- **技术栈**: Vue 3 + Vite + Element Plus + Axios。
- **运行环境**: Windows + PowerShell。

> 说明：文档尽量写步骤，不重复长代码。遇到大段代码时，直接写「参考原项目某某文件」即可，你可以对照现在这个项目边看边敲。

---

## 一、创建 Vue 3 + Vite 项目

1. **在 PowerShell 中进入你打算放项目的目录**

   ```powershell
   cd D:\  # 按你自己的路径调整
   ```

2. **使用 Vite 创建 Vue3 项目**

   ```powershell
   npm create vite@latest vue-landingPageFeedbackData
   ```

   交互选择：

   - **Project name**: `vue-landingPageFeedbackData`
   - **Framework**: `Vue`
   - **Variant**: `JavaScript`

3. **进入项目并安装依赖**

   ```powershell
   cd .\vue-landingPageFeedbackData\
   npm install
   ```

4. **安装本项目需要的额外依赖**

   ```powershell
   npm install element-plus @element-plus/icons-vue axios sass
   ```

---

## 二、清理 Vite 默认模板

1. **删除多余文件（可选）**

   - 删除 `src/assets` 下 Vite 自带的 logo 等文件（如果不需要可以删）。
   - 清空 `src/App.vue` 的默认内容，准备写自己的页面。

2. **调整 `index.html`**

   - 保留 Vite 默认结构即可，确保根节点是：

     ```html
     <div id="app"></div>
     ```

   - 脚本引用保持为：

     ```html
     <script type="module" src="/src/main.js"></script>
     ```

---

## 三、搭建入口文件 `src/main.js`

1. 打开 `src/main.js`，替换为当前项目的写法（你可以对照原项目直接敲）：

   - 从 `vue` 中导入 `createApp`。
   - 导入 `element-plus` 以及 `element-plus/dist/index.css`。
   - 导入 `@element-plus/icons-vue`。
   - 导入 `App.vue`。
   - 创建应用实例、注册 Element Plus、注册所有图标，然后挂载到 `#app`。

2. 如果不想看原文件，可以按下面的逻辑敲（伪代码级别）：

   ```js
   // 1. import { createApp } from 'vue'
   // 2. import ElementPlus, 样式, 图标
   // 3. import App.vue
   // 4. const app = createApp(App)
   // 5. app.use(ElementPlus)
   // 6. 循环注册 icons
   // 7. app.mount('#app')
   ```

> **参考原文档**：`src/main.js`

---

## 四、布局根组件 `src/App.vue`

1. 打开 / 新建 `src/App.vue`。
2. 写一个最简单的布局，用来承载 `FeedbackDataManagement` 组件，比如：

   - `<template>` 中只保留一个根容器，例如 `<FeedbackDataManagement />`。
   - `<script setup>` 中导入并注册 `FeedbackDataManagement.vue`。
   - 样式简单设置下页面背景、居中等。

> **参考原文档**：`src/App.vue` 中的完整实现。

---

## 五、创建接口封装文件 `src/api/feedback.js`

1. 在 `src` 目录下新建 `api` 目录：

   ```powershell
   mkdir .\src\api\
   ```

2. 新建 `src/api/feedback.js`，主要内容包括：

   - 导入 `axios`。
   - 定义一个 `generateMockData` 函数，用于本地生成一批假数据（包含 `id/email/feedback/deviceType/createTime/sessionId/adCampaign/...`）。
   - 使用 `axios.create` 创建 `api` 实例，`baseURL` 设为 `/api`。
   - 定义本地缓存 `cachedAllData`。
   - 写一个 `filterData(data, filters)` 函数，根据：
     - `deviceType`
     - `startTime`/`endTime`（用 `createTime` 转成 `Date` 对比）
     - `adCampaign` / `adGroup` / `adName` / `adContent`
     - `landingPageTheme` / `landingPageVariant`
     进行筛选。
   - 导出函数：
     - `getFeedbackData(params)`
       - 调用后端 `/feedback` 接口（或在出错时用本地 mock）。
       - 生成/使用 `cachedAllData`。
       - 根据 `filters` 调用 `filterData`。
       - 再根据 `page` 和 `pageSize` 做切片分页，返回 `{ data, total, allData }`。
     - `deleteFeedbackData(ids)`
       - 调用 `DELETE /feedback`，传 `{ ids }`。
     - `deleteAllFeedbackData()`
       - 调用 `DELETE /feedback/all`。

> **参考原文档**：`src/api/feedback.js` 完整代码（直接对着敲即可）。

---

## 六、创建主页面组件 `src/components/FeedbackDataManagement.vue`

1. 在 `src/components` 目录下新建文件：

   ```powershell
   mkdir .\src\components\  # 若已存在可跳过
   ni .\src\components\FeedbackDataManagement.vue
   ```

2. 在文件最顶部写上页面说明注释（可选，但原项目有）：

   - 说明这是「运营反馈数据管理页面」。
   - 简单描述：落地页访问、邮箱/反馈收集、本页面做筛选、统计、删除、导出。

3. **搭建模板结构 `<template>`**

   大致结构如下（边看原文件边敲）：

   - 外层用一个 `.feedback-management` 容器。
   - 使用 `el-card` 包住整个区域。
   - 上方是过滤条件区域：
     - 一行行 `el-row` + `el-col`。
     - 包含：
       - 设备类型下拉（移动端 / PC端）。
       - 开始时间 / 结束时间 `el-date-picker`（`type="datetime"`，`value-format="YYYY-MM-DD HH:mm:ss"`）。
       - 广告活动 `adCampaign`（包含 `Meeting_Strategist_ManualAndAI` / `Meeting_Strategist_Manual`）。
       - 广告组 `adGroup`。
       - 广告名称 `adName`。
       - 广告内容 `adContent`（`function` / `painpoint`）。
       - 落地页主题 `landingPageTheme`。
       - 落地页变体 `landingPageVariant`（`email` / `email_feedback`）。
     - 每个筛选控件绑定 `filters.xxx`，`@change="handleFilterChange"`。
   - 中间是汇总统计区域：
     - 显示总数据量 `total`。
     - 一排 `el-tag` 分别展示：
       - `仅UTM: utmOnly`
       - `有邮箱或反馈: hasEmailOrFeedback`
       - `仅邮箱: emailOnly`
       - `仅反馈: feedbackOnly`
       - `邮箱+反馈: emailAndFeedback`
     - 标签的 `type` 使用 info/primary/success/warning/danger 区分。
     - 右侧是按钮区域：
       - 刷新（`handleRefresh`）
       - 批量删除（`handleBatchDelete`）
       - 删除全部（`handleDeleteAll`）
       - 导出 Excel（`handleExport`，实际导出 CSV）。
   - 下方是表格 + 分页：
     - `el-table`：
       - `v-loading="loading"`
       - `:data="tableData"`
       - `@selection-change="handleSelectionChange"`
       - `@sort-change="handleSortChange"`
       - `style="width: 100%; min-width: 1700px"`
     - 列：
       - 多选列 `type="selection"`。
       - 序号 `id`。
       - 邮箱 `email`（未提交显示灰色）。
       - 反馈内容 `feedback`（未提交显示灰色）。
       - 设备类型 `deviceType`（`el-tag`，PC端/移动端用不同颜色）。
       - 广告活动 `adCampaign`、广告组、广告名称、广告内容、落地页主题、落地页变体。
       - 创建时间 `createTime`（`sortable="custom"`，用于点击表头排序）。
     - 分页 `el-pagination`：
       - 使用 `v-model:current-page="pagination.page"`
       - `v-model:page-size="pagination.pageSize"`
       - `@size-change="handleSizeChange"`
       - `@current-change="handlePageChange"`

> **参考原文档**：`src/components/FeedbackDataManagement.vue` 中 `<template>` 部分完整实现。

---

## 七、脚本逻辑 `<script setup>`（核心计算与交互）

在 `FeedbackDataManagement.vue` 的 `<script setup>` 中，按以下顺序实现逻辑（建议一行一行照原文件敲）：

1. **导入**

   - 从 `vue` 导入：`ref, reactive, computed, onMounted`。
   - 从 `element-plus` 导入：`ElMessage, ElMessageBox`。
   - 从 `@element-plus/icons-vue` 导入：`Refresh, Delete, Download`。
   - 从 `@/api/feedback` 导入：`getFeedbackData, deleteFeedbackData, deleteAllFeedbackData`。

2. **定义响应式状态**

   - `loading`：加载状态。
   - `tableData`：当前页数据。
   - `allData`：当前筛选条件下所有数据（不分页，用于统计和导出）。
   - `selectedRows`：表格多选中选中的行。
   - `sortOrder`：当前排序状态（ascending / descending / null）。
   - `filters`（`reactive` 对象）：
     - `deviceType/startTime/endTime/adCampaign/adGroup/adName/adContent/landingPageTheme/landingPageVariant`。
   - `pagination`（`reactive`）：
     - `page`、`pageSize`、`total`。

3. **计算属性**

   - `total`：直接返回 `pagination.total`。
   - `hasEmailOrFeedback`：
     - `email !== '未提交' || feedback !== '未提交'` 的条数。
   - `cvr`：
     - 公式：`hasEmailOrFeedback / total * 100`，保留 1 位小数。
   - `utmOnly`：
     - 邮箱和反馈都为 `'未提交'`。
   - `emailOnly`：
     - 有邮箱，无反馈。
   - `feedbackOnly`：
     - 有反馈，无邮箱。
   - `emailAndFeedback`：
     - 既有邮箱又有反馈。

4. **数据加载函数 `loadData`**

   - 组装 `params`：
     - `page`、`pageSize` + 所有 `filters` 字段。
   - 调用 `getFeedbackData(params)`。
   - 如果有 `response.allData`，赋值给 `allData`。
   - `tableData` 赋值 `response.data`。
   - `pagination.total` 赋值 `response.total`。
   - `try/catch` 中错误弹出 `ElMessage.error('加载数据失败')`。

5. **刷新、筛选、分页相关函数**

   - `handleRefresh`：
     - 调用 `loadData()`。
     - 成功提示。
   - `handleFilterChange`：
     - 把 `pagination.page` 重置为 1。
     - 调用 `loadData()`。
   - `handleSizeChange(val)`：
     - `pagination.pageSize = val`，`page` 置为 1。
     - 调用 `loadData()`。
   - `handlePageChange(val)`：
     - `pagination.page = val`。
     - 调用 `loadData()`。

6. **多选与删除相关函数**

   - `handleSelectionChange(selection)`：
     - 简单把 `selectedRows.value = selection`。
   - `handleBatchDelete`：
     - 如果 `selectedRows` 为空，提示「请选择要删除的数据」。
     - 使用 `ElMessageBox.confirm` 二次确认。
     - 将选中行的 `id` 收集成数组 `ids`，调用 `deleteFeedbackData(ids)`。
     - 删除成功后提示并刷新数据。
   - `handleDeleteAll`：
     - 使用 `ElMessageBox.confirm` 做危险操作确认。
     - 调用 `deleteAllFeedbackData()`。
     - 成功后刷新。

7. **导出函数 `handleExport`**

   - 逻辑：
     - 如果有勾选行，导出 `selectedRows`。
     - 否则导出 `allData`（当前筛选条件下所有数据）。
     - 如果没有数据，提示「暂无可导出的数据」。
   - 生成 CSV 字符串：
     - 先构造表头数组（ID、邮箱、反馈内容、设备类型、创建时间、Session ID 等）。
     - `map` 遍历每一行，按字段顺序生成数组。
     - 每个字段转成字符串，并对引号进行转义，再用 `"` 包一层，最后用 `,` 拼接。
   - 使用 `Blob` + `URL.createObjectURL` + 动态 `a` 标签触发下载。

> **参考原文档**：`src/components/FeedbackDataManagement.vue` 中 `<script setup>` 全部实现。

---

## 八、创建时间列的点击排序实现

1. **表格列声明**

   - 在 `<el-table>` 上监听 `@sort-change="handleSortChange"`。
   - 对 `createTime` 列加上 `sortable="custom"`。

2. **排序函数 `handleSortChange`**

   - 函数签名：`const handleSortChange = ({ prop, order }) => { ... }`。
   - 存储当前排序状态到 `sortOrder`。
   - 如果 `order` 或 `prop` 为空，则直接返回（表示取消排序）。
   - 对 `tableData.value` 做拷贝后排序：
     - 当 `prop === 'createTime'` 时，把 `a[prop]` / `b[prop]` 转成 `Date` 再比较。
     - `order === 'ascending'` 时：从最早到最近。
     - `order === 'descending'` 时：从最近到最早。
   - 这样点击表头会在「最近开始 / 最晚开始 / 取消排序」之间切换。

> **参考原文档**：`src/components/FeedbackDataManagement.vue` 中 `handleSortChange` 实现。

---

## 九、样式部分 `<style scoped lang="scss">`

1. 使用 `lang="scss"` + `scoped`。
2. 外层 `.feedback-management` 设置：

   - `width: 100vw`、`display: flex`、`flex-direction: column`。
   - `main-card` 设置卡片填满宽度、去圆角。
   - 调整 `:deep(.el-card__body)` 的 padding。

3. `filter-section` 设置灰色背景、内边距。

4. `summary-section` 使用 `flex` 水平排列，左右分布：

   - 左边标签行间距 `gap` 。
   - 右边操作按钮区域 `gap`。

5. `table-section`：

   - 让 `.table-wrapper` 支持横向滚动：`overflow-x: auto; overflow-y: visible;`。
   - 设置 `min-width: 0`，避免布局挤压。

6. 统一设置 `.not-submitted` 文本为灰色。

> **参考原文档**：`src/components/FeedbackDataManagement.vue` 中 `<style>` 部分。

---

## 十、运行与验证

1. **启动开发服务器**

   ```powershell
   npm run dev
   ```

2. **在浏览器中访问**

   - 一般默认是 `http://localhost:5173/`（以终端输出为准）。

3. **逐步验证功能**

   - 是否能加载出一张带 mock 数据的表格。
   - 顶部筛选：设备类型 / 时间 / 广告 / 落地页变体等是否生效。
   - 汇总区域的统计数字（特别是 CVR）是否实时变化。
   - 表格多选、批量删除、删除全部是否有确认弹窗。
   - **创建时间列**：
     - 点击表头，观察数据是否从最近 → 最早 / 最早 → 最近切换排序。
   - 导出：
     - 选中几条，再点击导出按钮，是否只导出勾选数据。
     - 不勾选，是否导出当前筛选条件下的全部数据。

---

## 十一、建议的练习顺序

你如果要完全手敲一遍，建议按下面顺序来：

1. 搭好项目骨架：`npm create vite` → 安装依赖 → 配好 `main.js` 与 `App.vue`。
2. 先写 `FeedbackDataManagement.vue` 的 **模板结构**（不写逻辑），确认页面布局和 Element Plus 组件都正常渲染。
3. 再一点点补上 `<script setup>` 中的状态、计算属性、`loadData`，让列表能显示 mock 数据。
4. 接着实现筛选、分页、刷新。
5. 然后实现删除与导出逻辑。
6. 最后实现「创建时间列点击排序」和样式微调。

全部完成之后，你再对照当前项目源码，检查每个部分是否一致，这样就相当于把整个项目自己从零实现了一遍。 


